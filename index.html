<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ancient Adventure</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=MedievalSharp&family=Spectral:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <style>
        :root { 
            --dnd-red: #8b0000; 
            --accent-gold: #d4af37;
            --deep-bg: #0d0d0d;
            --panel-bg: #1a1a1a;
        }
        
        body { 
            background-color: var(--deep-bg); 
            color: #e0e0e0; 
            font-family: 'Spectral', serif;
            background-image: url('https://www.transparenttextures.com/patterns/carbon-fibre.png');
        }

        h1, h2, h3, .font-fantasy { font-family: 'MedievalSharp', cursive; letter-spacing: 1px; }

        /* Стилізовані картки */
        .stat-card { 
            background: linear-gradient(145deg, #1e1e1e, #141414);
            border: 1px solid #333;
            border-top: 2px solid var(--accent-gold);
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            transition: transform 0.2s, border-color 0.2s;
        }
        .stat-card:hover { border-color: var(--dnd-red); }

        /* Поля вводу */
        input, textarea, select { 
            background: rgba(0,0,0,0.6) !important; 
            border: 1px solid #444 !important; 
            color: #fff !important; 
            border-radius: 4px; 
            transition: all 0.2s;
        }
        input:focus, textarea:focus { 
            border-color: var(--accent-gold) !important;
            box-shadow: 0 0 5px rgba(212, 175, 55, 0.3);
            outline: none;
        }

        /* Красиві точки */
        .slot-dot, .death-dot { 
            width: 14px; height: 14px; 
            border: 2px solid #444; 
            border-radius: 50%; 
            cursor: pointer;
            box-shadow: inset 0 0 3px #000;
        }
        .slot-dot.active { background: #3b82f6; box-shadow: 0 0 8px #3b82f6; border-color: #fff; }
        .death-dot.success.active { background: #10b981; box-shadow: 0 0 8px #10b981; border-color: #fff; }
        .death-dot.fail.active { background: #ef4444; box-shadow: 0 0 8px #ef4444; border-color: #fff; }

        /* Кнопки */
        .btn-gold {
            background: linear-gradient(to bottom, #d4af37, #aa850b);
            color: #000;
            font-weight: bold;
            text-transform: uppercase;
            border-radius: 4px;
            transition: all 0.2s;
        }
        .btn-gold:hover { transform: scale(1.05); filter: brightness(1.2); }

        /* Анімація розгортання */
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .expanded .collapsible-content { max-height: 200px; }

        /* Скроллбар */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: var(--accent-gold); border-radius: 10px; }
        
        .gold-text { color: var(--accent-gold); }
    </style>
</head>
<body class="p-2 md:p-6">

    <header class="max-w-[1400px] mx-auto mb-6 flex flex-wrap justify-between items-center bg-[#111] p-4 rounded-lg border-b-2 border-gold shadow-2xl gap-4">
        <div class="flex items-center gap-4">
            <div class="bg-gradient-to-br from-yellow-600 to-red-900 p-3 rounded-full shadow-lg">
                <i class="fa-solid fa-scroll text-black text-2xl"></i>
            </div>
            <div>
                <select id="char-selector" onchange="switchCharacter()" class="bg-transparent text-xl font-bold gold-text outline-none cursor-pointer"></select>
                <div class="text-[10px] uppercase tracking-[3px] text-gray-500">Ancient Adventure</div>
            </div>
        </div>
        
        <div class="flex gap-4">
            <div class="flex gap-4 items-center bg-black/40 px-4 py-2 rounded-full border border-gray-800">
                <button onclick="exportCharacter()" title="Експорт" class="hover:text-yellow-500 transition"><i class="fa-solid fa-download"></i></button>
                <label class="hover:text-green-500 transition cursor-pointer"><i class="fa-solid fa-upload"></i><input type="file" class="hidden" onchange="importCharacter(event)"></label>
            </div>
            <button onclick="createNewCharacter()" class="btn-gold px-6 py-2 text-xs">Новий Герой</button>
        </div>
    </header>

    <main class="max-w-[1400px] mx-auto grid grid-cols-1 md:grid-cols-4 gap-6">
        
        <section class="space-y-6">
            <div class="stat-card p-5">
                <input type="text" id="char-name" oninput="update('name')" class="w-full text-2xl font-bold bg-transparent border-none text-white mb-1" placeholder="Ім'я">
                <div class="flex justify-between items-center">
                    <input type="text" id="char-classLvl" oninput="update('classLvl')" class="text-xs gold-text font-bold bg-transparent border-none uppercase" placeholder="Клас та рівень">
                    <div class="text-[10px] text-gray-500">Prof: +<input type="number" id="char-prof" oninput="update('prof')" class="w-8 bg-transparent"></div>
                </div>
            </div>

            <div id="stats-container" class="grid grid-cols-1 gap-3"></div>

            <div class="stat-card p-4">
                <h3 class="text-xs font-bold gold-text uppercase mb-3 flex justify-between italic">Навички <span>Мод.</span></h3>
                <div id="skills-list" class="space-y-2 max-h-[300px] overflow-y-auto pr-2"></div>
            </div>
        </section>

        <section class="space-y-6">
            <div class="grid grid-cols-3 gap-4">
                <div class="stat-card p-3 text-center border-t-2 border-blue-500">
                    <div class="text-[9px] text-gray-500 uppercase font-bold">Armor Class</div>
                    <input type="number" id="char-ac" oninput="update('ac')" class="w-full text-center text-3xl font-fantasy bg-transparent border-none">
                </div>
                <div class="stat-card p-3 text-center border-t-2 border-yellow-500">
                    <div class="text-[9px] text-gray-500 uppercase font-bold">Initiative</div>
                    <input type="number" id="char-init" oninput="update('init')" class="w-full text-center text-3xl font-fantasy bg-transparent border-none">
                </div>
                <div class="stat-card p-3 text-center border-t-2 border-green-500">
                    <div class="text-[9px] text-gray-500 uppercase font-bold">Speed</div>
                    <input type="text" id="char-speed" oninput="update('speed')" class="w-full text-center text-2xl font-fantasy bg-transparent border-none">
                </div>
            </div>

            <div class="stat-card p-5 overflow-hidden relative">
                <div class="flex justify-between items-center mb-2">
                    <span class="text-sm font-bold uppercase gold-text">Hit Points</span>
                    <span class="text-lg font-fantasy"><span id="cur-hp" class="text-green-500">0</span> <span class="text-gray-600">/</span> <input type="number" id="char-maxHP" oninput="update('maxHP')" class="w-12 text-center bg-transparent"></span>
                </div>
                <div class="h-4 bg-black rounded-full border border-gray-800 p-0.5 mb-4">
                    <div id="hp-bar" class="h-full bg-gradient-to-r from-red-900 to-green-600 rounded-full shadow-[0_0_10px_rgba(22,163,74,0.5)] transition-all duration-500"></div>
                </div>
                <div class="flex gap-3">
                    <input type="number" id="hp-mod" placeholder="+/-" class="w-20 text-center text-lg font-bold">
                    <button onclick="changeHP(-1)" class="flex-1 bg-red-900/20 hover:bg-red-900/40 border border-red-900 text-red-500 rounded font-bold transition text-xs">ШКОДА</button>
                    <button onclick="changeHP(1)" class="flex-1 bg-green-900/20 hover:bg-green-900/40 border border-green-900 text-green-500 rounded font-bold transition text-xs">ЛІКУВАННЯ</button>
                </div>
                <div class="mt-6 flex justify-between items-center border-t border-gray-800 pt-4">
                    <div class="text-[10px] uppercase font-bold text-gray-500 tracking-widest">Death Saves</div>
                    <div class="flex gap-4">
                        <div class="flex gap-1" id="ds-success">
                            <div class="death-dot success" onclick="tglDS('success',0)"></div><div class="death-dot success" onclick="tglDS('success',1)"></div><div class="death-dot success" onclick="tglDS('success',2)"></div>
                        </div>
                        <div class="flex gap-1" id="ds-fail">
                            <div class="death-dot fail" onclick="tglDS('fail',0)"></div><div class="death-dot fail" onclick="tglDS('fail',1)"></div><div class="death-dot fail" onclick="tglDS('fail',2)"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="stat-card p-4">
                <h3 class="text-xs font-bold gold-text uppercase mb-4 flex justify-between">Магічні Комірки <i class="fa-solid fa-hat-wizard"></i></h3>
                <div id="slots-container" class="grid grid-cols-3 gap-3"></div>
                <button onclick="longRest()" class="w-full mt-6 py-2 bg-gradient-to-r from-gray-900 to-black border border-gray-700 rounded uppercase text-[10px] font-bold gold-text hover:border-gold transition">Long Rest (Повний відпочинок)</button>
            </div>
        </section>

        <section class="space-y-6">
            <div class="stat-card p-4 border-t-2 border-red-900">
                <h3 class="text-xs font-bold text-red-600 uppercase mb-3 italic">Арсенал (Зброя)</h3>
                <div class="bg-black/40 p-3 rounded border border-gray-800 mb-4">
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="wp-n" placeholder="Меч..." class="flex-1 px-2 py-1">
                        <input type="text" id="wp-a" placeholder="+Атк" class="w-12 text-center">
                    </div>
                    <textarea id="wp-d" placeholder="Шкода та ефекти..." class="w-full h-12 text-[10px] p-2 mb-2"></textarea>
                    <button onclick="addWp()" class="w-full btn-gold py-1 text-[10px]">Додати зброю</button>
                </div>
                <div id="weapons-list" class="space-y-2"></div>
            </div>

            <div class="stat-card p-4 border-t-2 border-purple-800">
                <h3 class="text-xs font-bold text-purple-500 uppercase mb-3 italic">Заклинання</h3>
                <div class="bg-black/40 p-3 rounded border border-gray-800 mb-4">
                    <div class="flex gap-2 mb-2">
                        <input type="text" id="sp-n" placeholder="Назва..." class="flex-1 text-[11px]">
                        <select id="sp-l" class="w-14"><option value="0">C</option><option value="1">L1</option><option value="2">L2</option><option value="3">L3</option></select>
                    </div>
                    <textarea id="sp-d" placeholder="Опис ефекту..." class="w-full h-12 text-[10px] p-2 mb-2"></textarea>
                    <button onclick="addSpell()" class="w-full bg-purple-900/50 hover:bg-purple-800 border border-purple-500 text-white py-1 text-[10px] rounded transition">Вивчити заклинання</button>
                </div>
                <div id="spell-list" class="max-h-60 overflow-y-auto pr-1"></div>
            </div>
        </section>

        <section class="space-y-6">
            <div class="stat-card p-4 border-t-2 border-yellow-600">
                <h3 class="text-xs font-bold text-yellow-600 uppercase mb-3 flex justify-between">Рюкзак <i class="fa-solid fa-bag-shopping"></i></h3>
                <div class="grid grid-cols-4 gap-2 mb-4">
                    <div><div class="text-[8px] text-center text-orange-400">CP</div><input type="number" id="char-cp" oninput="update('cp')" class="w-full text-center text-[10px]"></div>
                    <div><div class="text-[8px] text-center text-gray-400">SP</div><input type="number" id="char-sp" oninput="update('sp')" class="w-full text-center text-[10px]"></div>
                    <div><div class="text-[8px] text-center text-yellow-500">GP</div><input type="number" id="char-gp" oninput="update('gp')" class="w-full text-center text-[10px]"></div>
                    <div><div class="text-[8px] text-center text-blue-300">PP</div><input type="number" id="char-pp" oninput="update('pp')" class="w-full text-center text-[10px]"></div>
                </div>
                <div class="bg-black/40 p-3 rounded border border-gray-800 mb-4">
                    <input type="text" id="it-n" placeholder="Нова річ..." class="w-full mb-2 text-[11px]">
                    <textarea id="it-d" placeholder="Властивості речі..." class="w-full h-12 text-[10px] p-2 mb-2"></textarea>
                    <button onclick="addIt()" class="w-full bg-yellow-900/30 hover:bg-yellow-900/50 border border-yellow-700 text-yellow-500 py-1 text-[10px] rounded transition">Покласти в рюкзак</button>
                </div>
                <div id="inv-list" class="space-y-1"></div>
            </div>

            <div class="stat-card p-4 flex-1 flex flex-col min-h-[300px]">
                <h3 class="text-xs font-bold gold-text uppercase mb-2 border-b border-gray-800 pb-2 italic">Нотатки Пригод</h3>
                <textarea id="char-notes" oninput="update('notes')" class="flex-1 w-full bg-transparent border-none text-[12px] leading-relaxed resize-none p-0 outline-none" placeholder="Сьогодні ми зустріли дракона..."></textarea>
            </div>
        </section>
    </main>

    <script>
        // Скриптова логіка (ідентична попередній, але з оновленими назвами контейнерів)
        const skillList = ["Атлетика (STR)", "Акробатика (DEX)", "Скритність (DEX)", "Ловкість рук (DEX)", "Аналіз (INT)", "Історія (INT)", "Магія (INT)", "Природа (INT)", "Релігія (INT)", "Уважність (WIS)", "Виживання (WIS)", "Медицина (WIS)", "Прозорливість (WIS)", "Тварини (WIS)", "Виступ (CHA)", "Залякування (CHA)", "Обман (CHA)", "Переконання (CHA)"];
        const maxSlots = [4, 3, 3, 3, 2, 1, 1, 1, 1];

        const template = {
            name: "Герой", classLvl: "Воїн 1", stats: { STR: 10, DEX: 10, CON: 10, INT: 10, WIS: 10, CHA: 10 },
            ac: 10, init: 0, speed: "30", curHP: 10, maxHP: 10, prof: 2,
            cp: 0, sp: 0, gp: 0, pp: 0,
            inventory: [], spells: [], weapons: [], notes: "",
            slots: [0,0,0,0,0,0,0,0,0],
            ds: { success: [false,false,false], fail: [false,false,false] }
        };

        let chars = JSON.parse(localStorage.getItem('dnd_legend_v8')) || [{...template}];
        let idx = parseInt(localStorage.getItem('dnd_legend_idx')) || 0;

        window.onload = load;

        function load() {
            if (!chars[idx]) idx = 0;
            const c = chars[idx];
            ['name','classLvl','prof','ac','init','speed','maxHP','cp','sp','gp','pp','notes'].forEach(f => {
                const el = document.getElementById(`char-${f}`);
                if (el) el.value = c[f] !== undefined ? c[f] : "";
            });
            renderAll();
        }

        function renderAll() {
            renderStats(); renderSkills(); renderHP(); renderDS(); renderInv(); renderSpells(); renderWeapons(); renderSlots(); renderSelector();
        }

        function update(f) {
            const el = document.getElementById(`char-${f}`);
            chars[idx][f] = (el.type === 'number') ? parseInt(el.value) || 0 : el.value;
            if (f === 'name') renderSelector();
            if (f === 'maxHP') renderHP();
            save();
        }

        function save() {
            localStorage.setItem('dnd_legend_v8', JSON.stringify(chars));
            localStorage.setItem('dnd_legend_idx', idx);
        }

        function renderStats() {
            const cont = document.getElementById('stats-container');
            cont.innerHTML = Object.entries(chars[idx].stats).map(([k, v]) => {
                const mod = Math.floor((v-10)/2);
                return `<div class="stat-card p-3 flex justify-between items-center px-6 border-l-4 border-gold">
                    <span class="text-xs font-bold text-gray-500 uppercase tracking-tighter">${k}</span>
                    <input type="number" value="${v}" oninput="uStat('${k}',this.value)" class="w-12 text-center text-xl font-fantasy bg-transparent border-none">
                    <span class="text-sm gold-text font-bold w-10 text-right">${mod >= 0 ? '+' : ''}${mod}</span>
                </div>`;
            }).join('');
        }
        function uStat(k, v) { chars[idx].stats[k] = parseInt(v) || 0; renderStats(); renderSkills(); save(); }

        function renderSkills() {
            document.getElementById('skills-list').innerHTML = skillList.map(s => {
                const statKey = s.match(/\((.*?)\)/)[1];
                const mod = Math.floor((chars[idx].stats[statKey]-10)/2);
                return `<div class="flex justify-between items-center text-[11px] border-b border-white/5 py-1 px-1 hover:bg-white/5 transition">
                    <span class="text-gray-400">${s.split(' (')[0]}</span>
                    <span class="font-bold gold-text">${mod >= 0 ? '+' : ''}${mod}</span>
                </div>`;
            }).join('');
        }

        function renderHP() {
            const c = chars[idx];
            const p = Math.min(100, (c.curHP / c.maxHP) * 100);
            document.getElementById('hp-bar').style.width = p + '%';
            document.getElementById('cur-hp').innerText = c.curHP;
        }
        function changeHP(m) {
            const v = parseInt(document.getElementById('hp-mod').value) || 0;
            chars[idx].curHP = m > 0 ? Math.min(chars[idx].maxHP, chars[idx].curHP + v) : Math.max(0, chars[idx].curHP - v);
            document.getElementById('hp-mod').value = ''; renderHP(); save();
        }

        function renderSlots() {
            const cont = document.getElementById('slots-container');
            cont.innerHTML = maxSlots.map((max, levelIdx) => `
                <div class="bg-black/40 p-2 rounded-lg text-center border border-gray-800">
                    <div class="text-[8px] text-gray-500 mb-1 font-bold">LVL ${levelIdx+1}</div>
                    <div class="flex justify-center gap-1">${Array.from({length: max}, (_, i) => `
                        <div onclick="tglSlot(${levelIdx}, ${i})" class="slot-dot ${i < chars[idx].slots[levelIdx] ? 'active' : ''}"></div>
                    `).join('')}</div>
                </div>`).join('');
        }
        function tglSlot(lvl, i) { chars[idx].slots[lvl] = chars[idx].slots[lvl] === i + 1 ? i : i + 1; renderSlots(); save(); }

        function addWp() {
            const n = document.getElementById('wp-n').value;
            const a = document.getElementById('wp-a').value;
            const d = document.getElementById('wp-d').value;
            if(n) { chars[idx].weapons.push({name:n, atk:a, desc:d}); document.getElementById('wp-n').value=''; document.getElementById('wp-d').value=''; renderWeapons(); save(); }
        }
        function renderWeapons() {
            document.getElementById('weapons-list').innerHTML = chars[idx].weapons.map((w, i) => `
                <div class="bg-black/30 p-2 rounded border border-red-900/30 overflow-hidden">
                    <div class="flex justify-between items-center text-[11px] cursor-pointer" onclick="this.parentElement.classList.toggle('expanded'); this.nextElementSibling.classList.toggle('hidden')">
                        <span class="font-bold"><i class="fa-solid fa-crosshairs mr-2 text-red-900"></i>${w.name} <span class="text-red-500 ml-2">${w.atk}</span></span>
                        <button onclick="event.stopPropagation(); chars[idx].weapons.splice(${i},1); renderWeapons(); save()" class="text-gray-700 hover:text-red-500">✕</button>
                    </div>
                    <div class="hidden text-[10px] text-gray-400 mt-2 pt-2 border-t border-red-900/10 italic">${w.desc}</div>
                </div>`).join('');
        }

        function addSpell() {
            const n = document.getElementById('sp-n').value;
            const l = document.getElementById('sp-l').value;
            const d = document.getElementById('sp-d').value;
            if(n) { chars[idx].spells.push({name:n, lvl:l, desc:d}); document.getElementById('sp-n').value=''; document.getElementById('sp-d').value=''; renderSpells(); save(); }
        }
        function renderSpells() {
            document.getElementById('spell-list').innerHTML = chars[idx].spells.map((s, i) => `
                <div class="bg-black/20 p-2 border-b border-purple-900/10 hover:bg-purple-900/5">
                    <div class="flex justify-between items-center text-[11px] cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">
                        <span><b class="text-purple-500 mr-2">${s.lvl==0?'C':'L'+s.lvl}</b> ${s.name}</span>
                        <button onclick="event.stopPropagation(); chars[idx].spells.splice(${i},1); renderSpells(); save()" class="text-gray-700">✕</button>
                    </div>
                    <div class="hidden text-[10px] text-gray-400 mt-2 p-2 bg-black/40 rounded border border-purple-900/20">${s.desc}</div>
                </div>`).join('');
        }

        function addIt() {
            const n = document.getElementById('it-n').value;
            const d = document.getElementById('it-d').value;
            if(n) { chars[idx].inventory.push({name:n, desc:d}); document.getElementById('it-n').value=''; document.getElementById('it-d').value=''; renderInv(); save(); }
        }
        function renderInv() {
            document.getElementById('inv-list').innerHTML = chars[idx].inventory.map((it, i) => `
                <div class="bg-black/30 p-2 rounded text-[11px] border border-gray-800 mb-1">
                    <div class="flex justify-between items-center cursor-pointer" onclick="this.nextElementSibling.classList.toggle('hidden')">
                        <span><i class="fa-solid fa-gem mr-2 text-yellow-700 text-[9px]"></i>${it.name}</span>
                        <button onclick="event.stopPropagation(); chars[idx].inventory.splice(${i},1); renderInv(); save()" class="text-gray-700">✕</button>
                    </div>
                    <div class="hidden text-[10px] text-gray-500 pt-2 mt-2 border-t border-gray-800 italic">${it.desc}</div>
                </div>`).join('');
        }

        function tglDS(t, i) { chars[idx].ds[t][i] = !chars[idx].ds[t][i]; renderDS(); save(); }
        function renderDS() {
            chars[idx].ds.success.forEach((v, i) => document.querySelectorAll('#ds-success .death-dot')[i].classList.toggle('active', v));
            chars[idx].ds.fail.forEach((v, i) => document.querySelectorAll('#ds-fail .death-dot')[i].classList.toggle('active', v));
        }

        function longRest() {
            if(confirm("Повний відпочинок? Це відновить сили та затягне рани.")) {
                chars[idx].curHP = chars[idx].maxHP;
                chars[idx].slots = [0,0,0,0,0,0,0,0,0];
                chars[idx].ds = { success:[false,false,false], fail:[false,false,false] };
                save(); renderAll();
            }
        }

        function exportCharacter() {
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(chars));
            const dl = document.createElement('a');
            dl.setAttribute("href", dataStr);
            dl.setAttribute("download", chars[idx].name + "_vault.json");
            dl.click();
        }

        function importCharacter(ev) {
            const reader = new FileReader();
            reader.onload = (e) => { 
                try {
                    chars = JSON.parse(e.target.result); idx = 0; save(); load(); alert("Героїв завантажено з архіву!"); 
                } catch(e) { alert("Помилка файлу!"); }
            };
            reader.readAsText(ev.target.files[0]);
        }

        function renderSelector() {
            document.getElementById('char-selector').innerHTML = chars.map((c, i) => `<option value="${i}" ${i==idx?'selected':''}>${c.name}</option>`).join('');
        }
        function switchCharacter() { idx = parseInt(document.getElementById('char-selector').value); load(); save(); }
        function createNewCharacter() { chars.push(JSON.parse(JSON.stringify(template))); idx = chars.length - 1; load(); save(); }
        function deleteCurrentCharacter() { if(chars.length > 1 && confirm("Видалити персонажа з літопису?")) { chars.splice(idx, 1); idx = 0; load(); save(); } }
    </script>
</body>
</html>


